<!doctype html>
<html
  lang="{{ with site.Params.isoCode | default (site.LanguageCode | default `tr`) }}{{- . -}}{{ end }}"
  dir="{{ cond (site.Params.rtl | default false) `rtl` `ltr` }}"
  class="scroll-smooth"
  data-default-appearance="{{ site.Params.defaultAppearance | default `dark` }}"
  data-auto-appearance="{{ site.Params.autoSwitchAppearance | default `true` }}">
  {{- partial "head.html" . -}}
  {{- partialCached "init.html" . -}}

  <body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-100 antialiased min-h-screen selection:bg-primary/30" style="font-family: 'Inter', sans-serif;">
    <style>
      .post-card {
        background-color: rgba(30, 41, 59, 0.15);
        border: 1px solid rgba(51, 65, 85, 0.3);
        transition: all 0.3s ease;
      }
      .dark .post-card {
        background-color: rgba(30, 41, 59, 0.3);
        border: 1px solid rgba(51, 65, 85, 0.5);
      }
      .post-card:hover {
        border-color: #256af4;
        background-color: rgba(30, 41, 59, 0.25);
      }
      .dark .post-card:hover {
        background-color: rgba(30, 41, 59, 0.5);
      }
      .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
    </style>

    {{ partial "custom-nav.html" . }}

    <main class="max-w-5xl mx-auto px-6 py-12 md:py-20">
      {{/* =================== HERO =================== */}}
      <div class="mb-16">
        <h1 class="text-4xl md:text-6xl font-black tracking-tighter mb-4 text-slate-900 dark:text-white">
          Yazılar
        </h1>
        <p class="text-lg md:text-xl text-slate-600 dark:text-slate-400 max-w-2xl leading-relaxed">
          Gömülü sistemler, Linux, ağ teknolojileri ve yazılım mühendisliği üzerine düşünceler ve teknik yazılar.
        </p>

        {{/* Search Bar */}}
        <div class="mt-10">
          <div class="flex items-center max-w-xl rounded-xl bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-slate-700 focus-within:border-primary focus-within:ring-1 focus-within:ring-primary transition-colors">
            <span class="material-symbols-outlined text-slate-400 ml-4 text-xl shrink-0">search</span>
            <input
              type="text"
              id="post-search"
              placeholder="Yazılarda ara..."
              autocomplete="off"
              class="w-full bg-transparent px-3 py-3 text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none text-sm">
          </div>
          <p id="search-no-results" class="hidden mt-4 text-sm text-slate-500 dark:text-slate-400">Sonuç bulunamadı.</p>
        </div>
      </div>

      {{/* =================== POSTS =================== */}}
      {{ $allPosts := where .Site.RegularPages "Section" "posts" }}

      {{/* Featured Post (First/Latest) */}}
      {{ $featured := first 1 $allPosts }}
      {{ range $featured }}
        {{ $featuredImage := "" }}
        {{ $images := .Resources.ByType "image" }}
        {{ range slice "*feature*" "*cover*" "*thumbnail*" }}
          {{ if not $featuredImage }}
            {{ $featuredImage = $images.GetMatch . }}
          {{ end }}
        {{ end }}
        <article class="group mb-16 relative rounded-2xl overflow-hidden post-card p-6 md:p-8">
          <a href="{{ .RelPermalink }}" class="no-underline">
            <div class="grid md:grid-cols-2 gap-8 items-center">
              {{ if $featuredImage }}
                {{ $heroImg := $featuredImage.Fill "800x450 Center" }}
                <div class="aspect-video rounded-xl overflow-hidden bg-slate-200 dark:bg-slate-800 relative">
                  <img class="w-full h-full object-cover opacity-90 dark:opacity-80 group-hover:scale-105 transition-transform duration-500"
                       src="{{ $heroImg.RelPermalink }}" alt="{{ .Title }}" loading="eager">
                  <div class="absolute inset-0 bg-gradient-to-t from-background-dark/80 to-transparent"></div>
                </div>
              {{ end }}
              <div>
                <div class="flex items-center gap-3 mb-4">
                  <span class="px-2.5 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider bg-primary/20 text-primary">Öne Çıkan</span>
                  <span class="text-xs text-slate-500 dark:text-slate-400">
                    {{ .Date.Format "Jan 2, 2006" }} &bull; {{ .ReadingTime }} dk okuma
                  </span>
                </div>
                <h2 class="text-2xl md:text-3xl font-bold mb-4 group-hover:text-primary transition-colors text-slate-900 dark:text-white leading-tight">
                  {{ .Title }}
                </h2>
                {{ with .Description }}
                  <p class="text-slate-600 dark:text-slate-400 leading-relaxed mb-6">{{ . }}</p>
                {{ end }}
                <span class="inline-flex items-center gap-2 text-primary font-semibold">
                  Makaleyi Oku
                  <span class="material-symbols-outlined text-sm group-hover:translate-x-1 transition-transform">arrow_forward</span>
                </span>
              </div>
            </div>
          </a>
        </article>
      {{ end }}

      {{/* Remaining Posts Grid */}}
      {{ $remaining := after 1 $allPosts }}
      {{ if $remaining }}
        <div class="grid md:grid-cols-2 gap-8">
          {{ range $remaining }}
            {{ $featuredImage := "" }}
            {{ $images := .Resources.ByType "image" }}
            {{ range slice "*feature*" "*cover*" "*thumbnail*" }}
              {{ if not $featuredImage }}
                {{ $featuredImage = $images.GetMatch . }}
              {{ end }}
            {{ end }}
            <article class="post-card rounded-2xl p-5 group">
              <a href="{{ .RelPermalink }}" class="no-underline block">
                {{ if $featuredImage }}
                  {{ $thumb := $featuredImage.Fill "640x360 Center" }}
                  <div class="aspect-video rounded-xl overflow-hidden mb-5 bg-slate-200 dark:bg-slate-800">
                    <img class="w-full h-full object-cover opacity-80 dark:opacity-70 group-hover:scale-110 transition-transform duration-700"
                         src="{{ $thumb.RelPermalink }}" alt="{{ .Title }}" loading="lazy">
                  </div>
                {{ end }}
                <div class="flex items-center gap-2 mb-3">
                  {{ range .Params.categories | first 1 }}
                    <span class="text-[10px] font-bold uppercase tracking-wider text-primary">{{ . }}</span>
                    <span class="text-slate-400">&bull;</span>
                  {{ end }}
                  <span class="text-xs text-slate-500 dark:text-slate-400">
                    {{ .Date.Format "Jan 2, 2006" }} &bull; {{ .ReadingTime }} dk okuma
                  </span>
                </div>
                <h3 class="text-xl font-bold mb-3 group-hover:text-primary transition-colors text-slate-900 dark:text-white">
                  {{ .Title }}
                </h3>
                {{ with .Description }}
                  <p class="text-sm text-slate-600 dark:text-slate-400 leading-relaxed line-clamp-2">{{ . }}</p>
                {{ end }}
              </a>
            </article>
          {{ end }}
        </div>
      {{ end }}

      {{/* Pagination */}}
      {{ if gt (len $allPosts) 6 }}
        <div class="mt-20 flex justify-center">
          <a href="{{ "posts/" | relURL }}"
             class="flex items-center gap-2 px-8 py-3 rounded-full bg-slate-100 dark:bg-white/5 border border-slate-200 dark:border-white/10 text-slate-900 dark:text-white font-bold hover:bg-primary hover:text-white hover:border-primary transition-all duration-300 no-underline">
            Daha Fazla Yazı
            <span class="material-symbols-outlined">expand_more</span>
          </a>
        </div>
      {{ end }}
    </main>

    {{ partial "custom-footer.html" . }}

    {{/* Search overlay */}}
    {{ if .Site.Params.enableSearch | default false }}
      {{- partial "search.html" . -}}
    {{ end }}

    {{/* Mobile Menu Toggle */}}
    <script>
      (function() {
        const btn = document.getElementById('mobile-menu-btn');
        const menu = document.getElementById('mobile-menu');
        if (btn && menu) {
          btn.addEventListener('click', function() { menu.classList.toggle('hidden'); });
        }
      })();
    </script>

    {{/* Post Search — inline, no minification */}}
    <script data-turbo-eval="false">
      // @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&dn=expat.txt Expat
      document.addEventListener('DOMContentLoaded', function postSearchInit() {
        var searchInput = document.getElementById('post-search');
        var noResultsMsg = document.getElementById('search-no-results');
        if (!searchInput) return;
        var allArticles = document.querySelectorAll('main article');
        searchInput.addEventListener('input', function handleSearch() {
          var q = searchInput.value.toLowerCase().trim();
          var shown = 0;
          for (var i = 0; i < allArticles.length; i++) {
            var el = allArticles[i];
            var h = el.querySelector('h2') || el.querySelector('h3');
            var p = el.querySelector('p');
            var c = el.querySelector('[class*="text-primary"]');
            var blob = (h ? h.textContent : '') + ' ' + (p ? p.textContent : '') + ' ' + (c ? c.textContent : '');
            if (!q || blob.toLowerCase().indexOf(q) !== -1) {
              el.style.display = '';
              shown++;
            } else {
              el.style.display = 'none';
            }
          }
          if (noResultsMsg) {
            if (q && shown === 0) { noResultsMsg.classList.remove('hidden'); }
            else { noResultsMsg.classList.add('hidden'); }
          }
        });
      });
      // @license-end
    </script>
  </body>
</html>
